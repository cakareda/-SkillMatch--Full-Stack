<div class="job-container">
  <div *ngFor="let job of jobs" class="job-card">
    <h3 class="title">{{ job.title }}</h3>

    <ng-container *ngIf="currentUserSkills.length > 0">
      <div *ngIf="calculateMatchPercentage(job.requiredSkills) > 0" class="match-score">
        {{ calculateMatchPercentage(job.requiredSkills) }}% Matched
      </div>
    </ng-container>
    <p class="company">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M10 12h4"/><path d="M10 8h4"/><path d="M14 21v-3a2 2 0 0 0-4 0v3"/><path d="M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2"/><path d="M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16"/>
      </svg>
      {{ job.company }}
    </p>

    <p class="location">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"/><circle cx="12" cy="10" r="3"/>
      </svg>
      {{ job.location }}
    </p>

    <p class="salary">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
        </svg>
        {{ job.salary || 'Not Specified' }}
    </p>

    <p class="description">{{ job.description }}</p>

    <div *ngIf="job.requiredSkills && job.requiredSkills.length > 0" class="skills-container">
      <span *ngFor="let skill of job.requiredSkills" class="skill-tag">
        {{ skill }}
      </span>
    </div>
    <button class="apply-btn" (click)="openModal(job)">Apply Now</button>

    <div class="test-buttons" *ngIf="isAdmin$ | async">
      
      <button (click)="testUpdateJob(job.id)" class="test-btn update-btn">
        <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
          <path d="M3 3v5h5"/>
          <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>
          <path d="M16 16h5v5"/>
        </svg>
        Update
      </button>

      <button (click)="testDeleteJob(job.id)" class="test-btn delete-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-delete-icon lucide-delete"><path d="M10 5a2 2 0 0 0-1.344.519l-6.328 5.74a1 1 0 0 0 0 1.481l6.328 5.741A2 2 0 0 0 10 19h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z"/><path d="m12 9 6 6"/><path d="m18 9-6 6"/></svg>
        Delete
      </button>
    </div>
  </div>
</div>

<div class="add-job-container" *ngIf="isAdmin$ | async">
  <button (click)="testAddJob()" class="test-btn add-btn">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-plus-icon lucide-circle-plus">
      <circle cx="12" cy="12" r="10"/>
      <path d="M8 12h8"/>
      <path d="M12 8v8"/>
    </svg>
    Add New Job
  </button>
</div>

<div class="modal-backdrop" *ngIf="isModalOpen">
  <div class="modal">
    <h2>Apply for {{ selectedJob?.title }}</h2>

    <form (ngSubmit)="submitApplication()">
      <label>Full Name</label>
      <input type="text" [(ngModel)]="application.name" name="name" required>

      <label>Email</label>
      <input type="email" [(ngModel)]="application.email" name="email" required>

      <label>Cover Letter</label>
      <textarea [(ngModel)]="application.message" name="message" placeholder="Explain why you are a good fit for this position..." required></textarea>

      <div class="modal-buttons">
        <button type="submit" class="apply-btn">Submit Application</button>
        <button type="button" class="cancel-btn" (click)="closeModal()">Cancel</button>
      </div>
    </form>
  </div>
</div>